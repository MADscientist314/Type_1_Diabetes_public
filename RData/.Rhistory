nThread = 8,
showProgress = T)
#Write the file out to a table
data.table::fwrite(x = final_df,
file = "c:/github/Upwork/Mike_Lee/jochum_GISAID_06252021.tsv",
sep = "\t",
row.names = F,
nThread = 8,
showProgress = T)
#re-import the clean data
df<-fread("jochum_GISAID_06252021.tsv",sep = "\t",header = T)
#re-import the clean data
df<-fread("c:/github/Upwork/Mike_Lee/jochum_GISAID_06252021.tsv",sep = "\t",header = T)
df<-as_tibble(df)
#### Geographical overview
#fix 2 stupid names
df$Location_1<-gsub("North America/USA/New York/New York","North America",df$Location_1)
continents<-tally(~Location_1,df,'data.frame')%>%arrange(desc(Freq))
continents
df2<-as_tibble(strsplit(df$Variant,")", fixed=TRUE))
df2
df2<-separate(data = df,sep = "\\(",col = Variant,into = c("Variant","origin"))
#ok lets warngle the variant colum
df3<-separate(data = df2,sep = " ",col = Variant,into = c("Threat","Variant.line","Variant.name","Variant.name.2"))
df3<-df3%>%mutate(Variant.name=paste0(Variant.name," ",Variant.name.2))%>%select(-Variant.name.2)
df3
df3$Variant.line
df3$Variant.name
#ok lets fix the origin
df4<-separate(data = df3,col = origin,into = c("Variant","origin"),sep = "\\)")
df4<-df4%>%mutate(Variant.first.detected=gsub(" first detected in the ","",origin),
Variant.first.detected=gsub(" first detected in ","",Variant.first.detected))%>%
select(-origin)
df4
df4$Variant
df4$Variant<-as.factor(df4$Variant)
identical(df4$Variant,df4$Pango.lineage)
df4$Pango.lineage
df4$Pango.lineage<-as.factor(df4$Pango.lineage)
identical(df4$Variant,df4$Pango.lineage)
vec<-df4$Variant==df4$Pango.lineage
df4$Variant<-as.character(df4$Variant)
df4$Pango.lineage<-as.character(df4$Pango.lineage)
vec<-df4$Variant==df4$Pango.lineage
vec
isFALSE(vec)
isTRUE(vec)
diff(df4$Variant,df4$Pango.lineage)
tally(Variant~Pango.lineage,df4)
df4$Variant<-df4$Pango.lineage
df4$Pango.lineage<-NULL
df4$Variant.first.detected
favstats(df$Sequence.length)
final_df<-df4
getwd()
#Write the file out to a table
data.table::fwrite(x = final_df,
file = "c:/github/Upwork/Mike_Lee/jochum_GISAID_06252021.tsv",
sep = "\t",
row.names = F,
nThread = 8,
showProgress = T)
df4
summary(final_df)
res<-summary(final_df)
class(res)
as.data.frame(res)
as_tibble(res)
as.data.frame(res)
res<-as.data.frame(summary(final_df))
as_tibble(res)
res<-as_tibble(as.data.frame(summary(final_df)))
res
res$Var1
res%>%select(-Var1)%>%pivot_wider(names_from = Var2,values_from=Freq)
res<-res%>%select(-Var1)
res
res<-separate(data = res,col = Fres,into = c("Class","value"),sep = ":")
res<-separate(data = res,col = Freq,into = c("Class","value"),sep = ":")
res
res%>%pivot_wider(names_from = Class,values_from=value)
res<-as_tibble(as.data.frame(summary(final_df)))
res<-res%>%select(-Var1)
res<-separate(data = res,col = Freq,into = c("Class","value"),sep = ":",remove = T,convert = T)
res
res%>%pivot_wider(names_from = Class,values_from=value)
res<-separate(data = res,col = Freq,into = c("Class","value"),sep = ":",remove = T,convert = T,fill = NA)
res<-separate(data = res,col = Freq,into = c("Class","value"),sep = ":",remove = T,convert = T,extra = "drop")
res<-as_tibble(as.data.frame(summary(final_df)))
res<-res%>%select(-Var1)
res2<-separate(data = res,col = Freq,into = c("Class","value"),sep = ":",remove = T,convert = T,extra = "drop")
res2
res%>%pivot_wider(names_from = Class,values_from=value)
res2%>%pivot_wider(names_from = Class,values_from=value)
res2%>%pivot_wider(names_from = Class,values_from=value)%>%summarise_all()
res2<-separate(data = res,col = Freq,into = c("Class","value"),sep = ":",remove = T,extra = "drop")
res2
res2
complete.cases(res2)
complete.cases(res2[,])
res2[complete.cases()]
res2
res2%>%pivot_wider(names_from = Var2,values_from=value)
res2%>%pivot_wider(names_from = Var2,values_from=value)
res2<-separate(data = res,col = Freq,into = c("Class","value"),sep = ":",remove = T,extra = "drop")%>%distinct_all()
res2
res2%>%pivot_wider(names_from = Var2,values_from=value)
res2%>%pivot_wider(names_from = Class,values_from=value)
res2M-res2%>%pivot_wider(names_from = Class,values_from=value)
res2<-res2%>%pivot_wider(names_from = Class,values_from=value)
res2
tail(res2)
res2<-res2%>%pivot_wider(names_from = Class,values_from=value)
res2%>%select(-c(Length,`Class `,Mode,)
res2%>%select(-c(Length,`Class `,Mode,NA,`NA's   `))
res2%>%select(-c(Length,`Class `,Mode,NA,`NA's   `))
res2%>%select(-c(Length,`Class `,`  Mode,NA,`NA's   `))
res2%>%select(-c(Length,`Class `,`Mode  `,`NA's   `))
res2%>%select(-c(Length,`Class `,`Mode  `,`NA's   `, `NA` ))
res2<-res2%>%select(-c(Length,`Class `,`Mode  `,`NA's   `, `NA` ))
res2[complete.cases(res2)]
res2[complete.cases(res2[1:7])]
res2[complete.cases(res2[1:7,])]
res2[complete.cases(res2[,1:7])]
res2[complete.cases(res2[,1:51])]
res2[complete.cases(res2), ]
res2<-res2[complete.cases(res2), ]
res2
library(ggtree)
library(tidytree)
library(ggtree)
set.seed(2021)
tree <- rtree(50)
ggtree(tree)
tree
library(tidyverse)
set.seed(2021)
tree <- rtree(50)
as_tibble(tree)
ggtree(tree)
ggtree(tree, layout="slanted")
ggtree(tree, layout="circular")
ggtree(tree, layout="fan", open.angle=120)
ggtree(tree, layout="equal_angle")
tree <- rtree(10)
as_tibble(tree)
set.seed(2021)
tree <- rtree(10)
as_tibble(tree)
tree<-NULL
tree <- rtree(10)
as_tibble(tree)
tree <- rtree(20)
as_tibble(tree)
ggtree(tree)
glimpse(tree)
as.data.frame(tree)
as.data.frame(as_tiible(tree))
as.data.frame(as_ti\bible(tree))
as.data.frame(as_tibible(tree))
as.data.frame(as_tibble(tree))
tree<-NULL
tree <- rtree(10)
as.data.frame(as_tibble(tree))
rep(paste0("tree_",1:10))
tre<-tibble()
tre$label<-rep(paste0("tree_",1:10))
tre<-NULL
tre$label<-rep(paste0("tree_",1:10))
tre
tre<-as_tibble(rep(paste0("tree_",1:10)))
tre
tre$label<-as_tibble(rep(paste0("tree_",1:10)))
tre
tre<-NULL
tre$label<-as_tibble(rep(paste0("tree_",1:10)))
tre
tre<-tibble()%>%mutate(label=rep(paste0("tree_",1:10))
ggtree(tree)
tre<-tibble()%>%mutate(label=rep(paste0("tree_",1:10)))
tre<-NULL
tre<-tibble()%>%mutate(label=rep(paste0("tree_",1:10)))
tre$label<-as_tibble(rep(paste0("tree_",1:10)))
tre
label<-as_tibble(rep(paste0("tree_",1:10)))
tree <- rtree(10)
as.data.frame(as_tibble(tree))
tree <- rtree(10)
as.data.frame(as_tibble(tree))
tree<-NULL
tree
tree <- rtree(10)
as.data.frame(as_tibble(tree))
tree <- rtree(20)
as.data.frame(as_tibble(tree))
tree<-as.data.frame(as_tibble(tree))
label<-as_tibble(rep(paste0("tree_",1:39)))
tree$label<-as_tibble(rep(paste0("tree_",1:39)))
tre
tree
tree<-as_tibble(tree)
tree
tail(tree)
tree$label<-as_tibble(rep(paste0("tree_",1:39)))
tree
tree<-NULL
tree
tree <- rtree(20)
tree<- rtree(20)
as_tibble(tree)
tre<-as_tibble(tree)
tre$label<-as_tibble(rep(paste0("tree_",1:39)))
tree
tre
tail(tre)
tail(tree)
tree<-rtree(20)
tree
tre<-as_tibble(tree)
tre$label<-as_tibble(rep(paste0("tree_",1:39)))
tree
tail(tree)
tail(tre)
ggtree(tree)
glimpse(tree)
ggtree(tree, layout="slanted") +geom_tiplab(geom="label", offset=1, hjust=.5)
glimpse(tree)+geom_tiplab(geom="label", offset=1, hjust=.5)
tree2<-as.phylo(tre)
tree2<-as.phylo(x = tre)
tre
tre2<-as_data_frame(tre)
tree2<-as.phylo(x = tre2)
tree<-rtree(20)
tree
tre<-as_tibble(tree)
tre2<-as.phylo(tre)
tre$label<-as_tibble(rep(paste0("tree_",1:39)))
tre2<-as.phylo(tre)
tre<-as_tibble(tree)
tre2<-as.phylo(tre)
tre
tree<-rtree(4)
tree
tre<-as_tibble(tree)
tre2<-as.phylo(tre)
tre
ggtree(tre)
ggtree(tre2)
glimpse(tre2)+geom_tiplab(geom="label", offset=1, hjust=.5)
ggtree(tre2)+geom_tiplab(geom="label", offset=1, hjust=.5)
ggtree(tre2)+geom_text2()
ggtree(tre2)+geom_text2(label="label")
ggtree(tre2)+geom_text2(label=label)
ggtree(tre2)+geom_text2(label=label[1:7])
ggtree(tre2)+geom_text2(label=tre$label[1:7])
ggtree(tre2)+geom_text2(label=tre$label[1:7],offset=1, hjust=.5)
ggtree(tre2)+geom_text2(label=tre$label[1:7], hjust=.5)
ggtree(tre2)+geom_text2(label=tre$label[1:7], vjust=0.5 ,hjust=1.5)
ggtree(tre2)+geom_text2(label=tre$label[1:7], vjust=0.5 ,hjust=-1.5)
ggtree(tre2)+ggtree::geom_cladelabel2()+geom_tiplab(geom="label", offset=1, hjust=.5)
ggtree(tre2)+ggtree::geom_cladelabel2(node = node)+geom_tiplab(geom="label", offset=1, hjust=.5)
tail(tre)
ggtree(tre2)+ggtree::geom_cladelabel2(node = tre$node)+geom_tiplab(geom="label", offset=1, hjust=.5)
ggtree(tre2)+ggtree::geom_cladelabel2(node = tre$node,label = tre$label)+geom_tiplab(geom="label", offset=1, hjust=.5)
ggtree(tre2)+ggtree::geom_cladelabel2(node = tre$node,label = tre$label)#+geom_tiplab(geom="label", offset=1, hjust=.5)
tree<-rtree(50)
tree
tre<-as_tibble(tree)
tre2<-as.phylo(tre)
tre
tre$label<-as_tibble(rep(paste0("tree_",1:39)))
tre2<-as_data_frame(tre)
tree2<-as.phylo(x = tre2,)
tail(tre)
ggtree(tre2)
ggtree(tre2)+ggtree::geom_cladelabel2(node = tre$node,label = tre$label)#+geom_tiplab(geom="label", offset=1, hjust=.5)
ggtree(tre2)+geom_text2(label=tre$label[1:7], vjust=0.5 ,hjust=-1.5)
ggtree(tree, layout="slanted") +geom_tiplab(geom="label", offset=1, hjust=.5)
ggtree(tree, layout="circular")+geom_tiplab(geom="label", offset=1, hjust=.5)
library(treeio)
tree<-read.newick(file = "c:/github/Upwork/Mike_Lee/GISAID/GISAID-hCoV-19-phylogeny-2021-06-13/global.tree")
tree
tree$node.label
range(tree$node.label)
tree
get.fields(tree)
tree2<-as.phylo(x = tree,)
get.fields(tree2)
get.data(tree)
library(ape)
set.seed(2017)
tree <- rtree(4)
tree
x <- as_tibble(tree)
x
d <- tibble(label = paste0('cov2_', 1:4),
trait = rnorm(4))
y <- full_join(x, d, by = 'label')
y
tree <- rtree(4)
tree
x <- as_tibble(tree)
x
x<-x%>%mutate(label=gsub("t","cov2_"))
x<-x%>%mutate(label=gsub("t","cov2_",label))
x
d <- tibble(label = paste0('cov2_', 1:4),
trait = rnorm(4))
y <- full_join(x, d, by = 'label')
y
as.treedata(y)
y %>% as.treedata %>% as_tibble
library(data.table)
df<-as_tibble(fread("c:/github/Upwork/Mike_Lee/jochum_GISAID_07042021_100L.tsv"))
nhx_reduced <- drop.tip(tree, d$label)
nhx_reduced
tree<-read.newick(file = "c:/github/Upwork/Mike_Lee/GISAID/GISAID-hCoV-19-phylogeny-2021-06-13/global.tree")
tree
x <- as_tibble(tree)
x
to_drop<-x%>%filter(label%in%df$label)
to_drop$label
to_drop<-x%>%filter(!label%in%df$label)
to_drop$label
nhx_reduced <- drop.tip(tree, to_drop$label)
nhx_reduced
ggtree(nhx_reduced)
ggtree(nhx_reduced)+geom_tiplab2()
ggtree(nhx_reduced)+geom_tiplab()
ggtree(tree, branch.length='none', layout='circular')
tree_reduced <- drop.tip(tree, to_drop$label)
ggtree(tree_reduced)+geom_tiplab()
#plot a visualizatioin for Mike
ggtree(tree_reduced)+geom_tiplab(hjust = 0.5,offset = 1)
#plot a visualizatioin for Mike
ggtree(tree_reduced)+geom_tiplab(hjust = 0.5,offset = 0.1)
#plot a visualizatioin for Mike
ggtree(tree_reduced)+geom_tiplab(hjust = 0.05,offset = 0.1)
#plot a visualizatioin for Mike
ggtree(tree_reduced)+geom_tiplab(hjust = -0.05,offset = 0.1)
#plot a visualizatioin for Mike
ggtree(tree_reduced)+geom_tiplab(offset = 0.1)
#plot a visualizatioin for Mike
ggtree(tree_reduced)+geom_tiplab(hjust = -0.05)
#plot a visualizatioin for Mike
ggtree(tree_reduced)+geom_tiplab(label=label,hjust = -0.05)
#plot a visualizatioin for Mike
ggtree(tree_reduced)+geom_tiplab(label=df$label,hjust = -0.05)
ggtree(tree_reduced)+geom_tiplab(label=df$parent,hjust = -0.05)
ggtree(tree_reduced)+geom_tiplab(label=df$node,hjust = -0.05)
#plot a visualizatioin for Mike
lab<-ggtree(tree_reduced)+geom_tiplab(label=df$label,hjust = -0.05)
parent<-ggtree(tree_reduced)+geom_tiplab(label=df$parent,hjust = -0.05)
node<-ggtree(tree_reduced)+geom_tiplab(label=df$node,hjust = -0.05)
branch.length<-ggtree(tree_reduced)+geom_tiplab(label=df$branch.length,hjust = -0.05)
branch.length
df<-sample_n(tbl = df,size = 10)
df
glimpse(df)
glimpse(df)
#convert the newick tree to a tibble
x <- as_tibble(tree)
#make a vector of labels not in the header file
to_drop<-x%>%filter(!label%in%df$label)
#filter out the labels that are not in the header file
tree_reduced <- drop.tip(tree, to_drop$label)
#plot a visualizatioin for Mike
lab<-ggtree(tree_reduced)+geom_tiplab(label=df$label,hjust = -0.05)
parent<-ggtree(tree_reduced)+geom_tiplab(label=df$parent,hjust = -0.05)
node<-ggtree(tree_reduced)+geom_tiplab(label=df$node,hjust = -0.05)
branch.length<-ggtree(tree_reduced)+geom_tiplab(label=df$branch.length,hjust = -0.05)
lab
df<-sample_n(tbl = df,size = 10)
glimpse(df)
#convert the newick tree to a tibble
x <- as_tibble(tree)
#make a vector of labels not in the header file
to_drop<-x%>%filter(!label%in%df$label)
#filter out the labels that are not in the header file
tree_reduced <- drop.tip(tree, to_drop$label)
#plot a visualizatioin for Mike
lab<-ggtree(tree_reduced)+geom_tiplab(label=df$label,hjust = -0.05)
parent<-ggtree(tree_reduced)+geom_tiplab(label=df$parent,hjust = -0.05)
node<-ggtree(tree_reduced)+geom_tiplab(label=df$node,hjust = -0.05)
branch.length<-ggtree(tree_reduced)+geom_tiplab(label=df$branch.length,hjust = -0.05)
lab
#plot a visualizatioin for Mike
lab<-ggtree(tree_reduced)+geom_tiplab(label=df$label)
lab
df
#plot a visualizatioin for Mike
lab<-ggtree(tree_reduced,layout = "circular")+geom_tiplab(label=df$label)
lab
#plot a visualizatioin for Mike
lab<-ggtree(tree_reduced,layout = "circular")
lab
#plot a visualizatioin for Mike
lab<-ggtree(tree_reduced,layout = "circular")+geom_tiplab()
lab
branch.length
branch.length<-ggtree(tree_reduced,layout = "circular")+geom_tiplab(label=df$branch.length,hjust = -0.05)
lab
branch.length
branch.length<-ggtree(tree_reduced,layout = "circular")+geom_tiplab(label=df$branch.length)
branch.length
branch.length<-ggtree(tree_reduced,layout = "circular")+geom_tiplab(label=df$branch.length)
branch.length<-ggtree(tree_reduced,layout = "circular")+geom_text2(label=df$branch.length)
lab
branch.length<-ggtree(tree_reduced,layout = "circular")+geom_text2(label=branch.length)
branch.length
branch.length<-ggtree(tree_reduced,layout = "circular")+geom_text2(branch.length)
branch.length
branch.length<-ggtree(tree_reduced,layout = "circular")+geom_text(branch.length)
branch.length
branch.length<-ggtree(tree_reduced,layout = "circular")+geom_text(df$branch.length)
branch.length<-ggtree(tree_reduced,layout = "circular")+geom_tiplab2(label=df$branch.length)
branch.length
trree_reduced
tree_reduced
as_tibble(tree_reduced)
#plot a visualizatioin for Mike
lab<-ggtree(tree_reduced)+geom_tiplab()
lab
parent<-ggtree(tree_reduced)+geom_tiplab(label=df$parent,hjust = -0.05)
parent
node<-ggtree(tree_reduced)+geom_tiplab(label=df$node,hjust = -0.05)
node
branch.length
branch.length<-ggtree(tree_reduced,layout = "circular")+geom_tiplab(label=df$branch.length,hjust = -0.05)
branch.length
branch.length<-ggtree(tree_reduced)+geom_tiplab(label=df$branch.length,hjust = -0.05)
branch.length
branch.length<-ggtree(tree_reduced)+geom_tiplab(label=df$Pango.lineage,hjust = -0.05)
pango<-ggtree(tree_reduced)+geom_tiplab(label=df$Pango.lineage,hjust = -0.05)
pango
clade<-ggtree(tree_reduced)+geom_tiplab(label=df$Clade,hjust = -0.05)
clade
df<-as_tibble(fread("c:/github/Upwork/Mike_Lee/jochum_GISAID_07042021.tsv"))
#randomly sample 10 of the samples from the file you gave Mike Lee
df<-sample_n(tbl = df,size = 10)
glimpse(df)
glimpse(df)
#convert the newick tree to a tibble
x <- as_tibble(tree)
#make a vector of labels not in the header file
to_drop<-x%>%filter(!label%in%df$label)
#filter out the labels that are not in the header file
tree_reduced <- drop.tip(tree, to_drop$label)
as_tibble(tree_reduced)
#plot a visualizatioin for Mike
lab<-ggtree(tree_reduced)+geom_tiplab()
lab
lab<-ggtree(tree_reduced,layout = "circular")+geom_tiplab()
lab
as_tibble(tree_reduced)
df
#filter out the labels that are not in the header file
tree_reduced <- drop.tip(tree, to_drop$label)
glimpse(df)
#make a vector of labels not in the header file
to_drop<-x%>%filter(!label%in%df$label)
df
as_tibble(tree_reduced)
as_tibble(tree_reduced)
glimpse(df)
lab<-ggtree(tree_reduced,layout = "circular")+geom_tiplab()
lab
lab
#plot a visualizatioin for Mike
lab<-ggtree(tree_reduced)+geom_tiplab()
lab
parent<-ggtree(tree_reduced)+geom_tiplab(label=df$parent,hjust = -0.05)
node<-ggtree(tree_reduced)+geom_tiplab(label=df$node,hjust = -0.05)
branch.length<-ggtree(tree_reduced)+geom_tiplab(label=df$branch.length,hjust = -0.05)
lab
node
parent
branch.length
tree reduced
treereduced
tree_reduced
pango<-ggtree(tree_reduced)+geom_tiplab(label=df$Pango.lineage,hjust = -0.05)
clade<-ggtree(tree_reduced)+geom_tiplab(label=df$Clade,hjust = -0.05)
pango
clade
aa<-ggtree(tree_reduced)+geom_tiplab(label=df$AA.Substitutions,hjust = -0.05)
aa
aa<-ggtree(tree_reduced,ladderize = T)+geom_tiplab(label=df$AA.Substitutions,hjust = -0.05)
aa
aa<-ggtree(tree_reduced,ladderize = F)+geom_tiplab(label=df$AA.Substitutions,hjust = -0.05)
aa
aa<-ggtree(tree_reduced,ladderize = T,layout = "ape")+geom_tiplab(label=df$AA.Substitutions,hjust = -0.05)
aa
aa<-ggtree(tree_reduced,layout = "ape")+geom_tiplab(label=df$AA.Substitutions,hjust = -0.05)
aa
df$AA.Substitutions
aa<-ggtree(tree_reduced,layout = "ape")+geom_tiplab(label=df$AA.Substitutions,hjust = -0.05)
aa
#this script is designed to identify shared taxa in both the mother and the infant
#load libraries and set working direactory
library(phyloseq)
library(microbiome)
library(tidyverse)
setwd("c:/github/type1_diabetes_project/")
getwd()
#############preprocessing####################
ASV_physeq_core<-(readRDS("ASV_physeq_core.RDS"))
saveRDS(ASV_physeq_core,"ASV_physeq_core.RDS")
save(ASV_physeq_core,file = "Type_1_Diabetes_gh/ASV_physeq.RData")
#agglomerate to a genus level
ASV_physeq_core_genus<-tax_glom(ASV_physeq_core, taxrank = "Genus")
ASV_physeq_core_genus
